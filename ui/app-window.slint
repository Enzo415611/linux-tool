import { Button, VerticalBox, GridBox, TextEdit, LineEdit, ScrollView, HorizontalBox, ListView } from "std-widgets.slint";


export struct PackagesInfo {
    package_base: string,
    version: string,
    description: string,
    maintainer: string,
    co_maintainers: [string],
    depends: [string],
}

export global Logic {
    callback search_pkg(string);
    callback install_pkg(pkg_name:string);
    in-out property <string> app_name;
    in-out property <[PackagesInfo]> pkgs_info;
    in-out property <PackagesInfo> pkg_selected;
    in-out property <bool> pkg_info_is_visible;
}

component PkgSearch inherits VerticalBox {
    width: 100%; 
    height: 35px;
    padding: 0px;
    LineEdit {
        width: 600px;
        height: 33px;
        font-size: 15px;
        in-out property <string> prop;
        accepted(text) => {
            Logic.app_name = text;
            Logic.search_pkg(Logic.app_name)
        }
        
    }
}

component PkgList inherits ListView {
    height: 92%; 
    for pkg in Logic.pkgs_info: GridBox {
        padding: 1px;
        Button {
            text: pkg.package-base;
            clicked => {
                Logic.pkg_selected = pkg;
                Logic.pkg_info_is_visible = true;
                Logic.install_pkg(Logic.pkg_selected.package-base)
            }
        }
    }
}

component PkgInfo inherits VerticalBox {
    width: 50%;
    padding: 3px;
    visible: Logic.pkg_info_is_visible;
    
    
    Text {
        font-size: 19px;
        height: 28px;
        text: Logic.pkg_selected.package-base; 
    }
    
    Text {        
        font-size: 15px;
        height: 28px;
        text: "Version: " + Logic.pkg_selected.version; 
    }
    
    TextEdit {
        text: Logic.pkg_selected.description;
        font-size: 15px;
        enabled: false;
    }
    
    
    
    
}

export component AppWindow inherits Window {
    preferred-width: 800px;
    preferred-height: 600px;
    VerticalBox {
        HorizontalBox {
        Text {
            font-size: 18px; 
            text: "Search Package";
        }
            
            PkgSearch { }   
        }
        
        
        GridBox {
            width: 100%; 
            height: 100%;
            
            PkgList {}            
            
            PkgInfo {}
        }
        
    }
}
