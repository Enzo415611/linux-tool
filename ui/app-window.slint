import { PackagesInfo } from "logic.slint";
import { Button, VerticalBox, GridBox, TextEdit, LineEdit, ScrollView, HorizontalBox, ListView, Button } from "std-widgets.slint";
import { PkgSearch } from "pkg-search.slint";
import { PkgList } from "pkg-list.slint";
import { PkgInfo } from "pkg-info.slint";


export global Logic {
    in-out property <string> pkg_name;
    in-out property <[PackagesInfo]> pkgs_info;
    in-out property <PackagesInfo> pkg_selected;
    in-out property <bool> pkg_info_is_visible;
    in-out property <string> terminal_output;
    in-out property <string> terminal_input;
    in-out property <bool> terminal_is_visible: false;

    callback send_terminal_input(string);
    callback search_pkg(string);
    callback install_pkg(string);
    callback pkg_selected_callback(string);
}

export component AppWindow inherits Window {
    preferred-width: 800px;
    preferred-height: 600px;
    

    VerticalLayout {

        PkgSearch {
            search_pkg(name) => {
                Logic.pkg_name = name;
                Logic.search_pkg(name);
            };
        }
    
        
        GridBox {
            width: 100%; 
            
            PkgList {
            
                pkgs_info: Logic.pkgs_info;
                
                pkg_selected(pkg-selected) => {
                    Logic.pkg_selected = pkg-selected;    
                    Logic.pkg_selected_callback(pkg-selected.package-base);
                }

                pkg_info_is_visible(is) => {
                    Logic.pkg_info_is_visible = is;
                }

            }
                
            PkgInfo {                
                pkg_info_is_visible: Logic.pkg_info_is_visible;
                package-base: Logic.pkg_selected.package-base;
                version: Logic.pkg_selected.version;
                description: Logic.pkg_selected.description;
                maintainer: Logic.pkg_selected.maintainer;
                terminal_output: Logic.terminal_output;
                terminal_is_visible: Logic.terminal_is_visible;
                
                send_terminal_input(text) => {
                    Logic.terminal_input = text;
                    Logic.send_terminal_input(text);
                }

                install_pkg => {
                    Logic.install_pkg(Logic.pkg_selected.package-base);
                    Logic.terminal_is_visible = true;
                }

                
            }
        }

        // HorizontalBox {
        //     padding: 0px;
        //     alignment: LayoutAlignment.end;
            
        //     Rectangle {
        //         height: 20px;
        //         width: 100%;
        //         border-width: 0.3px;
        //         border-color: gray;

        //         HorizontalLayout {
        //             alignment: LayoutAlignment.end;
        //             Button {
        //                 text: "Terminal";
        //             }
        //         }  

        //     }
        // }
    }
}


